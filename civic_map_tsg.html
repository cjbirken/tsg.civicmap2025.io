<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Temple University Civic Map</title>

  <!-- Leaflet -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <style>
    html, body { height: 100%; margin: 0; }
    #map { height: 100%; width: 100%; }
    .legend {
      background: white;
      padding: 10px 12px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,.15);
      font: 14px/1.2 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    .legend h3 { margin: 0 0 8px; font-size: 14px; }
    .pill {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid #ddd;
      margin: 2px 6px 2px 0;
      font-size: 12px;
      white-space: nowrap;
    }
    .note {
      margin-top: 8px;
      font-size: 12px;
      color: #444;
      max-width: 280px;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script>
    // Pins here use specific coordinates (no guessy “Temple-ish” rounding).
    const PLACES = [
      // --- GOVERNMENT / CIVIC OFFICES ---
      {
        name: "Philadelphia City Hall",
        address: "1 S Penn Square, Philadelphia, PA",
        category: "City Government",
        lat: 39.9523944,
        lng: -75.1635972,
        details: "Philadelphia city government hub."
      },
      {
        name: "Municipal Services Building",
        address: "1401 John F Kennedy Blvd, Philadelphia, PA 19102",
        category: "City Government",
        lat: 39.9539457,
        lng: -75.1643162,
        details: "Permits, licenses, payments, admin offices."
      },
      {
        name: "State Rep. Malcolm Kenyatta District Office",
        address: "1501 N Broad St, Suite 17, Philadelphia, PA",
        category: "Elected Office",
        lat: 39.97595,
        lng: -75.15822,
        details: "Help with state-level paperwork, benefits, housing issues."
      },
      {
        name: "State Sen. Sharif Street District Office",
        address: "1621 W Jefferson St, Philadelphia, PA",
        category: "Elected Office",
        lat: 39.976497,
        lng: -75.162688,
        details: "Help with state agencies; education and state-level concerns."
      },

      // --- COMMUNITY / NEIGHBORHOOD ASSETS ---
      {
        name: "Cecil B. Moore Library (Free Library Branch)",
        address: "2320 Cecil B. Moore Ave, Philadelphia, PA 19121",
        category: "Community",
        lat: 39.98049,
        lng: -75.17354,
        details: "Library resources, community programming, job help."
      },
      {
        name: "Columbia North YMCA",
        address: "1400 N Broad St, Philadelphia, PA 19121",
        category: "Community",
        lat: 39.975042,
        lng: -75.159029,
        details: "Gym + community hub; programs and outreach."
      },

      // --- TRANSIT (SEPTA Metro B / Broad Street Line) ---
      {
        name: "Cecil B. Moore / Temple University Station (SEPTA Metro B)",
        address: "1700 N Broad St, Philadelphia, PA",
        category: "Transit",
        // FIXED: moved to the station entrance point (south of the rounded value)
        lat: 39.978713,
        lng: -75.157854,
        details: "Broad Street Line stop serving Temple University."
      },
      {
        name: "Susquehanna–Dauphin Station (SEPTA Metro B)",
        address: "2200 N Broad St, Philadelphia, PA",
        category: "Transit",
        lat: 39.9871,
        lng: -75.1559,
        details: "Broad Street Line stop north of campus."
      },

      // --- ADDED (4 more locations) ---
      {
        name: "Broad–Girard Station (SEPTA Metro B + Metro G)",
        address: "1200 N Broad St, Philadelphia, PA",
        category: "Transit",
        lat: 39.971472,
        lng: -75.159089,
        details: "Express BSL stop + Girard Ave trolley connection."
      },
      {
        name: "Howard Gittis Student Center",
        address: "1755 N 13th St, Philadelphia, PA 19122",
        category: "Campus Services",
        lat: 39.9793804,
        lng: -75.1550022,
        details: "Student center (lots of student-facing services live here)."
      },
      {
        name: "Charles Library (Temple University Libraries)",
        address: "1900 N 13th St, Philadelphia, PA 19122",
        category: "Campus Services",
        lat: 39.9821476,
        lng: -75.1553679,
        details: "Main campus library + major study and public resource hub."
      },
      {
        name: "Temple University Hospital – Main Campus",
        address: "3401 N Broad St, Philadelphia, PA 19140",
        category: "Health Services",
        lat: 40.0049091,
        lng: -75.1510384,
        details: "Major hospital (emergency care + specialty services)."
      }
    ];

    const map = L.map("map", { scrollWheelZoom: true }).setView([39.9815, -75.1565], 14);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Layer groups (toggleable)
    const layers = {
      "City Government": L.layerGroup(),
      "Elected Office": L.layerGroup(),
      "Community": L.layerGroup(),
      "Transit": L.layerGroup(),
      "Campus Services": L.layerGroup(),
      "Health Services": L.layerGroup()
    };

    const safe = (s) => String(s ?? "").replace(/[&<>"']/g, m => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[m]));

    function popupHTML(p) {
      return `
        <div style="font:14px/1.25 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;">
          <div style="font-weight:700; margin-bottom:4px;">${safe(p.name)}</div>
          <div style="margin-bottom:6px;">${safe(p.address)}</div>
          <div style="margin-bottom:6px;"><span class="pill">${safe(p.category)}</span></div>
          <div style="color:#333;">${safe(p.details)}</div>
          <div style="margin-top:8px;">
            <a target="_blank" rel="noopener"
              href="https://www.openstreetmap.org/?mlat=${encodeURIComponent(p.lat)}&mlon=${encodeURIComponent(p.lng)}#map=18/${encodeURIComponent(p.lat)}/${encodeURIComponent(p.lng)}">
              View on OpenStreetMap
            </a>
          </div>
        </div>
      `;
    }

    const bounds = [];

    for (const p of PLACES) {
      if (typeof p.lat !== "number" || typeof p.lng !== "number") continue;

      const marker = L.marker([p.lat, p.lng]).bindPopup(popupHTML(p));

      if (!layers[p.category]) layers[p.category] = L.layerGroup();
      marker.addTo(layers[p.category]);

      bounds.push([p.lat, p.lng]);
    }

    // Add all layers by default
    Object.values(layers).forEach(lg => lg.addTo(map));

    L.control.layers(null, layers, { collapsed: false }).addTo(map);

    if (bounds.length) map.fitBounds(bounds, { padding: [30, 30] });

    // Legend
    const legend = L.control({ position: "bottomleft" });
    legend.onAdd = function () {
      const div = L.DomUtil.create("div", "legend");
      div.innerHTML = `
        <h3>Temple Civic Map</h3>
        <div>
          <span class="pill">City Government</span>
          <span class="pill">Elected Office</span>
          <span class="pill">Community</span>
          <span class="pill">Transit</span>
          <span class="pill">Campus Services</span>
          <span class="pill">Health Services</span>
        </div>
        <div class="note">
          Click any pin to see the location name, address,
      and what you can do there.
        </div>
      `;
      return div;
    };
    legend.addTo(map);
  </script>
</body>
</html>